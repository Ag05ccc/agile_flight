<?xml version="1.0"?>
<launch>
    <arg name="quad_name" default="blackbird"/>
    <arg name="use_bem_propeller_model" default="False"/>
    <arg name="use_unity" default="False"/>
    <arg name="render" default="False"/>
    <arg name="race_track" default="real_track"/>
    <arg name="save_data" default="false"/>
    <param name="/use_sim_time" value="True"/>
    <arg name="real_time_factor" value="1.0"/>
    <arg name="gui" default="True"/>
    <arg name="rviz" default="True"/>
    <arg name="mock_vio_params_file" default="$(find agilib)/params/mock_vio.yaml"/>

    <group ns="$(arg quad_name)">
        <node name="agiros_pilot" pkg="environment" type="environment_node" output="screen">
            <param name="param_dir" value="$(find agilib)/params"/>
            <param name="ros_param_dir" value="$(find environment)/parameters"/>
            <param name="use_bem_propeller_model" value="$(arg use_bem_propeller_model)"/>
            <param name="pilot_config" value="simple_sim_pilot.yaml"/>
            <param name="race_config" value="$(find environment)/parameters/tracks/$(arg race_track).yaml"/>
            <param name="real_time_factor" value="$(arg real_time_factor)"/>
            <param name="render" value="$(arg render)"/>
        </node>
    </group>

    <!-- Visualization -->
    <node pkg="rviz" type="rviz" name="viz_face" args="-d $(find environment)/resources/rviz/environment.rviz"
          ns="$(arg quad_name)" if="$(arg rviz)"/>

    <!-- GUI -->
    <node name="agiros_gui" pkg="rqt_gui" type="rqt_gui"
          args="-s agiros_gui.basic_flight.BasicFlight --args --quad_name $(arg quad_name)" output="screen"
          if="$(arg gui)"/>

    <!-- Flightmare Standalone -->
    <node name="flight_render" pkg="flightrender" type="RPG_Flightmare.x86_64" if="$(arg use_unity)"/>
    <!-- args="-batchmode"/> -->

    <!-- Data saving -->
    <include file="$(find data_saver)/launch/data_saver.launch" if="$(arg save_data)">
        <arg name="quad_name" default="blackbird"/>
        <arg name="base_folder" default="/tmp/dagger_det_mock_vio/train_RL_80ms/"/>
        <arg name="odom_save_freq" default="50"/>
        <arg name="gate_det_save_freq" default="20"/>
        <arg name="gt_command_save_freq" default="50"/>
        <arg name="save_imgs" default="False"/>
        <arg name="save_detector_labels" default="False"/>
        <arg name="pitch_angle" default="0"/>
        <arg name="horizontal_fov" default="110"/>
        <arg name="img_width" default="640"/>
        <arg name="img_height" default="480"/>
        <arg name="gate_labels_save_freq" default="10"/>
    </include>
</launch>